import{L as Y}from"./auto.79026103.js";import{h as y}from"./moment.9709ab41.js";import{_ as g,h as P,n as C,r as w,o as l,c as h,a as i,t as c,e as m,F as S,i as v,j as M,v as k,b as x,l as A,p as E,f as L}from"./index.e5775ca1.js";const O={components:{Line:Y},data(){return{firebaseData:null,ripeness:null,rawData:null,chartData:{labels:[],datasets:[]},chartOptions:{responsive:!0,lineTension:.4,radius:6,elements:{point:{radius:3}},scales:{x:{grid:{display:!1}},y:{grid:{display:!0},ticks:{callback:function(s,t,e){return s+"%"}}}},maintainAspectRatio:!1},countryStats:[],countryPeriodStats:{},countryPeriodArtifactsCount:{},ripenessStats:{ripe:0,underripe:0,overripe:0},periodStats:{},yearStats:{},filterYear:null,filterCounty:null,total_artifacts:0}},watch:{filterYear(){this.structureData()}},mounted(){let s=this.$route.params.ripeness;s?this.ripeness=s:this.$router.go(-1),this.getData()},methods:{async getData(){const s=await P(C(A,"predictions"));let t=[];s.forEach(e=>{let a=e.data();t.push(a)}),t=t.sort((e,a)=>e.predictedAt-a.predictedAt),this.rawData=t,this.structureData()},structureData(){this.total_artifacts=0,this.periodStats={},this.ripenessStats={ripe:0,underripe:0,overripe:0};let s={};this.rawData.forEach(t=>{let e=t.region;s[e]||(s[e]={artifacts:0,underripe:0,overripe:0,ripe:0});let a=this.formatYear(t.predictedAt);this.yearStats[a]||(this.yearStats[a]=0),this.countryPeriodStats[e]||(this.countryPeriodStats[e]={}),this.countryPeriodArtifactsCount[e]||(this.countryPeriodArtifactsCount[e]={}),s[e].artifacts+=1,this.total_artifacts+=1,s[e].underripe+=t.underripe,s[e].overripe+=t.overripe,s[e].ripe+=t.ripe,this.ripenessStats.ripe+=t.ripe,this.ripenessStats.underripe+=t.underripe,this.ripenessStats.overripe+=t.overripe,this.countryStats=s;let r=this.formatMonthYear(t.predictedAt);this.countryPeriodStats[e][r]||(this.countryPeriodStats[e][r]={ripe:0,underripe:0,overripe:0}),this.countryPeriodArtifactsCount[e][r]||(this.countryPeriodArtifactsCount[e][r]=0),(this.filterYear&&this.filterYear==a||!this.filterYear)&&(this.countryPeriodStats[e][r].ripe+=t.ripe,this.countryPeriodStats[e][r].underripe+=t.underripe,this.countryPeriodStats[e][r].overripe+=t.overripe,this.countryPeriodArtifactsCount[e][r]+=1,this.periodStats[r]||(this.periodStats[r]={ripe:0,underripe:0,overripe:0},this.periodStats[r].ripe+=t.ripe,this.periodStats[r].underripe+=t.underripe,this.periodStats[r].overripe+=t.overripe))}),this.changeChartData()},changeChartData(){let s=Object.keys(this.periodStats),t=[];Object.keys(this.countryPeriodStats).forEach(a=>{let r=this.countryPeriodStats[a],d=`rgb(${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)})`,p=[];s.forEach(o=>{var u,f,_;let n=(u=this.countryPeriodArtifactsCount[a][o])!=null?u:1,D=(_=(f=r[o])==null?void 0:f[this.ripeness])!=null?_:0;p.push(D/n)}),t.push({label:a,backgroundColor:d,borderColor:d,data:p})});let e={labels:s,datasets:t};console.log(e),this.chartData=e},formatMonthYear(s){return y(new Date(s)).format("MMM YYYY")},formatYear(s){return y(new Date(s)).format("YYYY")}}},b=s=>(E("data-v-d4947b06"),s=s(),L(),s),V={class:"contsdainer-fluid"},j={class:"row mt-5 mx-3"},B={class:"col-12"},I={class:"display-3 mb-4 text-capitalize"},z={class:"col-md-3 sidebar-sum"},N={class:"text-muted"},R={class:"text-capitalize"},F={class:"card country-summary-card mb-3 p-3 shadow border-0"},T={class:"table"},q={class:"border-bottom"},U=b(()=>i("th",null,"Country",-1)),G={class:"text-capitalize"},H={class:"col-md-9"},J={class:"col-4"},K=b(()=>i("option",{value:null,selected:""},"Select Year",-1)),Q=["value"],W={class:""};function X(s,t,e,a,r,d){const p=w("Line");return l(),h("main",V,[i("div",j,[i("div",B,[i("h2",I,c(r.ripeness)+" Statistics",1)]),i("div",z,[i("p",N,[m("Below are country statistics for average "),i("b",R,c(r.ripeness),1),m(" cherry")]),i("div",F,[i("table",T,[i("tr",q,[U,i("th",G,c(r.ripeness),1)]),(l(!0),h(S,null,v(r.countryStats,(o,n)=>(l(),h("tr",{key:n},[i("td",null,c(n),1),i("td",null,c(Math.round(o[r.ripeness]/o.artifacts))+"%",1)]))),128))])])]),i("div",H,[i("div",J,[M(i("select",{class:"form-select","onUpdate:modelValue":t[0]||(t[0]=o=>r.filterYear=o)},[K,(l(!0),h(S,null,v(Object.keys(r.yearStats),(o,n)=>(l(),h("option",{value:o,key:n},c(o),9,Q))),128))],512),[[k,r.filterYear]])]),i("div",W,[x(p,{chartData:r.chartData,"chart-options":r.chartOptions,"chart-data":r.chartData,"chart-id":"d_chart","dataset-id-key":"label",width:400,height:400},null,8,["chartData","chart-options","chart-data"])])])])])}const et=g(O,[["render",X],["__scopeId","data-v-d4947b06"]]);export{et as default};
