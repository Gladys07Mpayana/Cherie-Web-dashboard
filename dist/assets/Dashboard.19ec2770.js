import{L as y}from"./auto.79026103.js";import{h as m}from"./moment.9709ab41.js";import{_ as D,h as k,n as C,r as b,o as d,c as p,a as t,b as h,w as _,F as f,i as v,j as S,v as x,k as Y,l as M,e as A,t as o,p as O,f as V}from"./index.e5775ca1.js";const E={components:{Line:y},data(){return{firebaseData:null,rawData:null,chartData:null,chartOptions:{responsive:!0,lineTension:.4,radius:6,pointDotRadius:1,elements:{point:{radius:3}},interaction:{mode:"point"},scales:{x:{grid:{display:!1}},y:{grid:{display:!0},ticks:{callback:function(r,e,i){return r+"%"}}}},maintainAspectRatio:!1},countryStats:[],ripenessStats:{ripe:0,underripe:0,overripe:0},periodStats:{},yearStats:{},filterCounty:null,filterYear:null,total_artifacts:0}},watch:{filterCounty(){this.structureData()},filterYear(){this.structureData()}},mounted(){this.getData()},methods:{async getData(){const r=await k(C(M,"predictions"));console.log(r);let e=[];r.forEach(i=>{let l=i.data();e.push(l)}),e=e.sort((i,l)=>i.predictedAt-l.predictedAt),this.rawData=e,this.structureData()},structureData(){this.total_artifacts=0,this.periodStats={},this.ripenessStats={ripe:0,underripe:0,overripe:0};let r={};this.rawData.forEach(e=>{let i=e.region;r[i]||(r[i]={artifacts:0,underripe:0,overripe:0,ripe:0}),r[i].artifacts+=1,this.total_artifacts+=1,r[i].underripe+=e.underripe,r[i].overripe+=e.overripe,r[i].ripe+=e.ripe,this.ripenessStats.ripe+=e.ripe,this.ripenessStats.underripe+=e.underripe,this.ripenessStats.overripe+=e.overripe,this.countryStats=r;let l=this.formatYear(e.predictedAt);if(this.yearStats[l]||(this.yearStats[l]=0),console.log(this.filterYear,l),(this.filterCounty&&e.region==this.filterCounty||!this.filterCounty&&this.filterYear)&&(this.filterYear&&this.filterYear==l||!this.filterYear&&this.filterCounty)){let s=this.formatMonthYear(e.predictedAt);console.log("matched"),this.periodStats[s]||(this.periodStats[s]={ripe:0,underripe:0,overripe:0},this.periodStats[s].ripe+=e.ripe,this.periodStats[s].underripe+=e.underripe,this.periodStats[s].overripe+=e.overripe)}else if(!this.filterCounty&&!this.filterYear){let s=this.formatMonthYear(e.predictedAt);this.periodStats[s]||(this.periodStats[s]={ripe:0,underripe:0,overripe:0},this.periodStats[s].ripe+=e.ripe,this.periodStats[s].underripe+=e.underripe,this.periodStats[s].overripe+=e.overripe)}}),console.log("test",this.periodStats),this.changeChartData()},triggerPrint(){window.print()},changeChartData(){let r={labels:Object.keys(this.periodStats),datasets:[{label:"Ripe",backgroundColor:"#75EFA6",pointColor:"#75EFA6",borderColor:"#75EFA6",data:Object.values(this.periodStats).map(e=>e.ripe)},{label:"Under ripe",backgroundColor:"#FB896B",borderColor:"#FB896B",data:Object.values(this.periodStats).map(e=>e.underripe).reverse()},{label:"Over ripe",backgroundColor:"#6956E5",borderColor:"#6956E5",data:Object.values(this.periodStats).map(e=>e.overripe).reverse()}]};this.chartData=r},formatMonthYear(r){return m(new Date(r)).format("MMM YYYY")},formatYear(r){return m(new Date(r)).format("YYYY")}}},n=r=>(O("data-v-aead7632"),r=r(),V(),r),B={class:"contsdainer-fluid"},F={class:"row mt-5 mx-3"},j={class:"col-md-12 mb-3"},H={class:"d-flex mb-3"},R=n(()=>t("h3",null,"Aggregate ripeness stats",-1)),U=n(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-printer",viewBox:"0 0 16 16"},[t("path",{d:"M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"}),t("path",{d:"M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"})],-1)),z={class:"row"},L={class:"col-sm-3"},I={class:"alert alert-ripe text-center",role:"alert"},N={class:"fw-bolder text-black fs-4"},T=n(()=>t("p",{class:"text-black"},"Ripe",-1)),P={class:"col-sm-3"},q={class:"alert alert-under text-center",role:"alert"},G={class:"fw-bolder text-black fs-4"},J=n(()=>t("p",{class:"text-black"},"Under ripe",-1)),K={class:"col-sm-3"},Q={class:"alert alert-over text-center",role:"alert"},W={class:"fw-bolder text-black fs-4"},X=n(()=>t("p",{class:"text-black"},"Over Ripe",-1)),Z={class:"col-sm-3"},$={class:"alert alert-warning text-center",role:"alert"},tt={class:"fw-bolder text-black fs-4"},et=n(()=>t("p",{class:"text-black"},"Total Uploads",-1)),st={class:"col-md-3 sidebar-sum"},rt={class:"card-body"},at={class:"mb-4"},it={class:"table-responsive"},ot=n(()=>t("tr",{class:"border-bottom"},[t("th",null,"Ripe"),t("th",null,"Underripe"),t("th",null,"Overripe")],-1)),lt={class:"col-md-9"},nt={class:"row"},ct={class:"col-6"},dt=n(()=>t("option",{value:null,selected:""},"Select Country",-1)),pt=["value"],ht={class:"col-4 offset-2"},ut=n(()=>t("option",{value:null,selected:""},"Select Year",-1)),_t=["value"],ft={key:0,class:"mt-4"};function vt(r,e,i,l,s,g){const u=b("router-link"),w=b("Line");return d(),p("main",B,[t("div",F,[t("div",j,[t("div",H,[R,h(u,{to:"",onClick:g.triggerPrint,class:"ms-4 mt-1 nav-link btn"},{default:_(()=>[U,A(" Export ")]),_:1},8,["onClick"])]),t("div",z,[t("div",L,[h(u,{class:"text-reset text-decoration-none",to:{name:"ripeness_stats",params:{ripeness:"ripe"}}},{default:_(()=>[t("div",I,[t("p",N,o(Math.round(s.ripenessStats.ripe/s.total_artifacts))+"%",1),T])]),_:1})]),t("div",P,[h(u,{class:"text-reset text-decoration-none",to:{name:"ripeness_stats",params:{ripeness:"underripe"}}},{default:_(()=>[t("div",q,[t("p",G,o(Math.round(s.ripenessStats.underripe/s.total_artifacts))+"%",1),J])]),_:1})]),t("div",K,[h(u,{class:"text-reset text-decoration-none",to:{name:"ripeness_stats",params:{ripeness:"overripe"}}},{default:_(()=>[t("div",Q,[t("p",W,o(Math.round(s.ripenessStats.overripe/s.total_artifacts))+"%",1),X])]),_:1})]),t("div",Z,[t("div",$,[h(u,{to:{name:"artifacts"},class:"text-reset text-decoration-none"},{default:_(()=>[t("p",tt,o(s.total_artifacts),1),et]),_:1})])])])]),t("div",st,[(d(!0),p(f,null,v(s.countryStats,(a,c)=>(d(),p("div",{class:"card country-summary-card mb-3 shadow border-0",key:c},[t("div",rt,[t("h4",at,o(c)+" ("+o(a.artifacts)+")",1),t("div",it,[t("table",null,[ot,t("tr",null,[t("td",null,o(Math.round(a.ripe/a.artifacts)),1),t("td",null,o(Math.round(a.underripe/a.artifacts)),1),t("td",null,o(Math.round(a.overripe/a.artifacts)),1)])])])])]))),128))]),t("div",lt,[t("div",nt,[t("div",ct,[S(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=a=>s.filterCounty=a)},[dt,(d(!0),p(f,null,v(s.countryStats,(a,c)=>(d(),p("option",{value:c,key:c},o(c),9,pt))),128))],512),[[x,s.filterCounty]])]),t("div",ht,[S(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=a=>s.filterYear=a)},[ut,(d(!0),p(f,null,v(Object.keys(s.yearStats),(a,c)=>(d(),p("option",{value:a,key:c},o(a),9,_t))),128))],512),[[x,s.filterYear]])])]),s.chartData?(d(),p("div",ft,[h(w,{chartData:s.chartData,"chart-options":s.chartOptions,"chart-data":s.chartData,"chart-id":"d_chart","dataset-id-key":"label",width:400,height:400},null,8,["chartData","chart-options","chart-data"])])):Y("",!0)])])])}const xt=D(E,[["render",vt],["__scopeId","data-v-aead7632"]]);export{xt as default};
